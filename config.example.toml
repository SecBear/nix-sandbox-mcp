# nix-sandbox-mcp configuration
#
# This file defines which environments are available and how they're sandboxed.

[daemon]
transport = "stdio"
log_level = "info"

[defaults]
backend = "jail"          # "jail" (fast, namespace isolation) or "microvm" (secure, VM isolation)
timeout_seconds = 30      # Maximum execution time per invocation
memory_mb = 512           # Memory limit for sandbox

# ─────────────────────────────────────────────────────────────────
# Project Configuration (Optional)
#
# Mount a project directory into all sandbox environments.
# This allows code to access project files (e.g., run tests, read configs).
# ─────────────────────────────────────────────────────────────────

[project]
path = "."               # Project directory (default: current directory)
mount_point = "/project" # Where to mount inside sandbox (default: /project)
# Note: Project is always mounted read-only. Use Claude's Edit tool for modifications.
# use_flake = true       # Create "project" env from project's devShell (requires flake.nix)
#
# [project.inherit_env]
# vars = ["DATABASE_URL", "RUST_LOG"]  # Host env vars to pass into sandbox

# ─────────────────────────────────────────────────────────────────
# Environments
#
# Each environment defines what tools/packages are available.
# Use 'preset' for bundled environments or 'flake' for custom ones.
# ─────────────────────────────────────────────────────────────────

[environments.shell]
preset = "shell"
# bash, coreutils, grep, sed, awk, findutils, jq, tree, diffutils, file, bc

[environments.python]
preset = "python"
# python3 (+pyyaml), coreutils

[environments.node]
preset = "node"
# nodejs, coreutils

# ─────────────────────────────────────────────────────────────────
# Custom environments (examples - uncomment to use)
# ─────────────────────────────────────────────────────────────────

# Custom flake with explicit interpreter
# [environments.jq-shell]
# flake = "nixpkgs#jq"          # Any flake reference (nixpkgs, github:, local path)
# interpreter = "bash -s"       # Optional: default is "bash -s"

# Python environment from nixpkgs
# [environments.python-alt]
# flake = "nixpkgs#python3"
# interpreter = "python3 -c"

# Reference your own flake
# [environments.dev]
# flake = "github:myorg/dev-envs#default"

# Use microVM for untrusted code (Phase 3)
# [environments.untrusted]
# flake = "github:someone/env#thing"
# backend = "microvm"
# memory_mb = 1024

# ─────────────────────────────────────────────────────────────────
# Session Persistence (Optional)
#
# Enable persistent state across run() calls using the `session` parameter.
# Variables, imports, and /workspace files persist within a session.
# ─────────────────────────────────────────────────────────────────

[session]
idle_timeout_seconds = 300   # Reap sessions idle for this long (default: 300s / 5min)
max_lifetime_seconds = 3600  # Maximum session lifetime regardless of activity (default: 3600s / 1hr)
# Note: Reaper runs every 60s, so actual precision is ±60s

# ─────────────────────────────────────────────────────────────────
# Backend Configuration
# ─────────────────────────────────────────────────────────────────

[backends.jail]
# jail.nix (bubblewrap) settings
# Default combinators provide: tmpfs home, no network, isolated namespaces

[backends.microvm]
hypervisor = "cloud-hypervisor"  # "cloud-hypervisor" | "qemu" | "firecracker"
